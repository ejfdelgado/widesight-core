import md5 from 'md5';
import { MyDatesFront } from '@ejfdelgado/ejflab-common/src/MyDatesFront';
import { BasicProcessor } from './BasicProcessor';

export class SavePublicImage extends BasicProcessor {
  async process(elem: any, source: any): Promise<any> {
    let base64: string =
      'data:image/jpeg;base64,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Zy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjk3ZTM4ZGEzLWQwYjUtNDNmZi04Y2M0LThmYmZmYTc4MTk0ZCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5M2I4YWM4NC01YWQ3LTQ5YzEtYmFlMS0zOGZhMDg0MjFiYmQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4YmJmMjdiOS04YjE3LTQ5MjUtYjk2ZC04ZmM5MTY0ZWM0NzEiIGRjOkZvcm1hdD0iaW1hZ2UvanBlZyIgR0lNUDpBUEk9IjIuMCIgR0lNUDpQbGF0Zm9ybT0iTGludXgiIEdJTVA6VGltZVN0YW1wPSIxNzE4NTkyMjY5MzIwMzMyIiBHSU1QOlZlcnNpb249IjIuMTAuMzAiIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0OmNoYW5nZWQ9Ii8iIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZjdlMDMxMTEtZWQ0OS00NzUwLTkwOWQtYmY2OWRjOWI1Yjk2IiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIgc3RFdnQ6d2hlbj0iMjAyNC0wNi0xNlQyMTo0Mzo0Mi0wNTowMCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0OmNoYW5nZWQ9Ii8iIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MzAzYjQ2NGYtMGNjNC00MGIxLWFjYWQtNTI3YTc4ODkzMmM1IiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIgc3RFdnQ6d2hlbj0iMjAyNC0wNi0xNlQyMTo0NDoyOS0wNTowMCIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0idyI/Pv/iArBJQ0NfUFJPRklMRQABAQAAAqBsY21zBDAAAG1udHJSR0IgWFlaIAfoAAYAEQACACwACGFjc3BBUFBMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD21gABAAAAANMtbGNtcwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADWRlc2MAAAEgAAAAQGNwcnQAAAFgAAAANnd0cHQAAAGYAAAAFGNoYWQAAAGsAAAALHJYWVoAAAHYAAAAFGJYWVoAAAHsAAAAFGdYWVoAAAIAAAAAFHJUUkMAAAIUAAAAIGdUUkMAAAIUAAAAIGJUUkMAAAIUAAAAIGNocm0AAAI0AAAAJGRtbmQAAAJYAAAAJGRtZGQAAAJ8AAAAJG1sdWMAAAAAAAAAAQAAAAxlblVTAAAAJAAAABwARwBJAE0AUAAgAGIAdQBpAGwAdAAtAGkAbgAgAHMAUgBHAEJtbHVjAAAAAAAAAAEAAAAMZW5VUwAAABoAAAAcAFAAdQBiAGwAaQBjACAARABvAG0AYQBpAG4AAFhZWiAAAAAAAAD21gABAAAAANMtc2YzMgAAAAAAAQxCAAAF3v//8yUAAAeTAAD9kP//+6H///2iAAAD3AAAwG5YWVogAAAAAAAAb6AAADj1AAADkFhZWiAAAAAAAAAknwAAD4QAALbEWFlaIAAAAAAAAGKXAAC3hwAAGNlwYXJhAAAAAAADAAAAAmZmAADypwAADVkAABPQAAAKW2Nocm0AAAAAAAMAAAAAo9cAAFR8AABMzQAAmZoAACZnAAAPXG1sdWMAAAAAAAAAAQAAAAxlblVTAAAACAAAABwARwBJAE0AUG1sdWMAAAAAAAAAAQAAAAxlblVTAAAACAAAABwAcwBSAEcAQv/bAEMAAQEBAQEBAQEBAQEBAQEBAgEBAQEBAgEBAQICAgICAgICAgMDBAMDAwMDAgIDBAMDBAQEBAQCAwUFBAQFBAQEBP/bAEMBAQEBAQEBAgEBAgQDAgMEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBP/CABEIABAAEAMBEQACEQEDEQH/xAAWAAEBAQAAAAAAAAAAAAAAAAABBgj/xAAZAQABBQAAAAAAAAAAAAAAAAAAAQQFBgf/2gAMAwEAAhADEAAAAdTP4lCvq2wqH//EABgQAAMBAQAAAAAAAAAAAAAAAAUGBwIV/9oACAEBAAEFAmxw4RpScO6bokyyXZp3MsiGb//EACERAAIABQUBAQAAAAAAAAAAAAECAwQFESEABiIxQXES/9oACAEDAQE/AY22a/U8y80yqW42KqSDgL4xscAg/b6g7Zr9MzMTLMgYfq5VrAYK+sATgkn5bVH3xTadt+TpceQV5iWiO6RSATZshfDZX5DPfWqxvmnVDb85S5eQVJiYiI7xQADZRcr6bM/I5771/8QAIBEAAQIFBQAAAAAAAAAAAAAAAQMEAAIFESEyUXGB4f/aAAgBAgEBPwFKpsG2tEE2ze572hWpMHOhEA2xbHe0OKYqq6UWlVIknABHHkN6Yqk6TWnVJkkBAHPmI//EACAQAAIDAAICAwEAAAAAAAAAAAECAwQRBRIAFAYTIjH/2gAIAQEABj8C5LjZ/knJmaCyK78fPbtxdA05VZY5OrIcjdWKkHemDDvnG8ZD8j5NZp7Jrpx0Fu3KGCzgNLJJ1VBsaMwUAZ3w6c8fnpK5ka1fiSnY9L246O1vrZ2ZQWj/AGB2OfzPF56OuY2q35VuWPT9SO9lb6w6swDSDuzdTmZvn//EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/ITFHKQ9UJo34BwIZAJ/UJonwFyCxZkrG9BqKkLGVLzvGJFQaix//2gAMAwEAAgADAAAAENy//8QAGBEBAQEBAQAAAAAAAAAAAAAAAREAMSH/2gAIAQMBAT8QHuulgSAmF66iRAW2YsJZG4nRQo+mC7iRaqiIRKUKubt/EiqoAlVhSg7/xAAcEQEBAAIDAQEAAAAAAAAAAAABEQAhMUFRYXH/2gAIAQIBAT8QKJ8iACVdqVJRPJO7AvYghWIpGgKAftwuwRULovZXRfObi1Ai0ug8BTRr4Z//xAAWEAEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQEAAT8QbOl2cJQ3DGFFFjx3IUdRh1BGnYSuSHdDW3s3l4tFIyAWl7//2Q==';
    if (source) {
      base64 = source.toDataURL();
    }
    const seedSize = 32;
    const seed = base64.substring(base64.length - seedSize, seedSize);
    const response = await this.fileService.save(
      {
        base64,
        fileName: `${
          this.configId
        }/${MyDatesFront.getDayAsContinuosNumberHmmSSmmm(new Date())}-${md5(
          seed
        )}.jpg`,
        isPublic: true,
        isImage: true,
      },
      {
        showIndicator: true,
      }
    );
    elem.uri = response.uri;
    //elem.uri = 'https://www.google.com';
    return elem;
  }
}
